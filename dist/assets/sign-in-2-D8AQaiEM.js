import{c as S,f as w,r as _,u as b,g as N,o as I,j as e,d as k,L as P,B as u,s as L,e as F,t as h}from"./index-CyLddbD6.js";import{L as E}from"./logo-_X_zCFti.js";import{u as T,a as A,F as B,b as g,c as p,d as f,e as x,f as j}from"./form-YB8ixuth.js";import{I as U}from"./input-CXl4TFaQ.js";import{P as C}from"./password-input-By29Rogt.js";import{L as R}from"./loader-circle-CCL1A7uO.js";import"./label-CcUkce7_.js";import"./eye-BIYauoJj.js";import"./eye-off-DydWkWCO.js";const V=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],O=S("log-in",V),$="/assets/TraceVault-DnWvPnw4.png",y="http://localhost:8000",o=w.create({baseURL:y,timeout:3e4,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(s=>{const t=localStorage.getItem("access_token");return t&&(s.headers.Authorization=`Bearer ${t}`),s},s=>Promise.reject(s));o.interceptors.response.use(s=>s,async s=>{const t=s.config;if(s.response?.status===401&&!t._retry){t._retry=!0;try{const r=localStorage.getItem("refresh_token");if(r){const a=await w.post(`${y}/api/auth/refresh`,{refresh_token:r}),{access_token:l,refresh_token:i}=a.data;return localStorage.setItem("access_token",l),i&&localStorage.setItem("refresh_token",i),t.headers.Authorization=`Bearer ${l}`,o(t)}}catch(r){return localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/login",Promise.reject(r)}}return Promise.reject(s)});class M{async login(t,r){try{const a=await o.post("/api/auth/login",{email:t,password:r});return localStorage.setItem("access_token",a.data.access_token),localStorage.setItem("refresh_token",a.data.refresh_token),localStorage.setItem("user",JSON.stringify(a.data.user)),a.data}catch(a){throw new Error(a.response?.data?.detail||"Login failed")}}async logout(){try{await o.post("/api/auth/logout",{})}catch{}finally{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user")}}async getCurrentUser(){try{return(await o.get("/api/auth/me")).data}catch(t){throw new Error(t.response?.data?.detail||"Failed to get user info")}}async changePassword(t,r){try{await o.post("/api/auth/change-password",{current_password:t,new_password:r})}catch(a){throw new Error(a.response?.data?.detail||"Failed to change password")}}async refreshToken(){try{const t=localStorage.getItem("refresh_token");if(!t)throw new Error("No refresh token available");const r=await o.post("/api/auth/refresh",{refresh_token:t});return localStorage.setItem("access_token",r.data.access_token),r.data.refresh_token&&localStorage.setItem("refresh_token",r.data.refresh_token),r.data}catch(t){throw localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),new Error(t.response?.data?.detail||"Failed to refresh token")}}isAuthenticated(){return!!localStorage.getItem("access_token")}getToken(){return localStorage.getItem("access_token")}getUser(){const t=localStorage.getItem("user");return t?JSON.parse(t):null}}const q=new M,z=I({email:F({error:s=>s.input===""?"Please enter your email":void 0}),password:L().min(1,"Please enter your password").min(7,"Password must be at least 7 characters long")});function D({className:s,redirectTo:t,...r}){const[a,l]=_.useState(!1),i=b(),{auth:d}=N(),m=T({resolver:A(z),defaultValues:{email:"",password:""}});async function v(c){l(!0);try{const n=await q.login(c.email,c.password);d.setUser({accountNo:n.user.id.toString(),email:n.user.email,role:[n.user.role],exp:Date.now()+1440*60*1e3}),d.setAccessToken(n.access_token),h.success(`Welcome back, ${n.user.first_name}!`),i({to:t||"/",replace:!0})}catch(n){h.error(n.message||"Sign in failed"),l(!1)}}return e.jsx(B,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(v),className:k("grid gap-3",s),...r,children:[e.jsx(g,{control:m.control,name:"email",render:({field:c})=>e.jsxs(p,{children:[e.jsx(f,{children:"Email"}),e.jsx(x,{children:e.jsx(U,{placeholder:"name@example.com",...c})}),e.jsx(j,{})]})}),e.jsx(g,{control:m.control,name:"password",render:({field:c})=>e.jsxs(p,{className:"relative",children:[e.jsx(f,{children:"Password"}),e.jsx(x,{children:e.jsx(C,{placeholder:"********",...c})}),e.jsx(j,{}),e.jsx(P,{to:"/forgot-password",className:"absolute end-0 -top-0.5 text-sm font-medium text-muted-foreground hover:opacity-75",children:"Forgot password?"})]})}),e.jsxs(u,{className:"mt-2",disabled:a,children:[a?e.jsx(R,{className:"animate-spin"}):e.jsx(O,{}),"Sign in"]}),e.jsxs("div",{className:"relative my-2",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsx(u,{variant:"outline",type:"button",disabled:a,className:"w-full",children:"OAuth"})]})})}function J(){return e.jsxs("div",{className:"relative container grid h-svh flex-col items-center justify-center lg:max-w-none lg:grid-cols-2 lg:px-0 dark bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:[e.jsxs("div",{className:"lg:p-8 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:[e.jsx("div",{className:"mx-auto flex w-full flex-col justify-center space-y-2 py-8 sm:w-[480px] sm:p-8",children:e.jsxs("div",{className:"mb-4 flex items-center justify-center",children:[e.jsx(E,{className:"me-2"}),e.jsx("h1",{className:"text-xl font-medium text-white",children:"TraceVault"})]})}),e.jsxs("div",{className:"mx-auto flex w-full max-w-sm flex-col justify-center space-y-2",children:[e.jsxs("div",{className:"flex flex-col space-y-2 text-start",children:[e.jsx("h2",{className:"text-lg font-semibold tracking-tight text-white",children:"Sign in"}),e.jsxs("p",{className:"text-sm text-slate-300",children:["Enter your email and password below ",e.jsx("br",{}),"to log into your account"]})]}),e.jsx(D,{}),e.jsxs("p",{className:"px-8 text-center text-sm text-slate-400",children:["By clicking sign in, you agree to our"," ",e.jsx("a",{href:"/terms",className:"text-blue-400 underline underline-offset-4 hover:text-blue-300",children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"/privacy",className:"text-blue-400 underline underline-offset-4 hover:text-blue-300",children:"Privacy Policy"}),"."]})]})]}),e.jsx("div",{className:k("relative h-full overflow-hidden bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 max-lg:hidden flex items-center justify-center"),children:e.jsx("img",{src:$,width:1347,height:1361,alt:"TraceVault",className:"h-80 w-80 object-contain drop-shadow-2xl"})})]})}const se=J;export{se as component};
